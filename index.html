<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¥¿æ¾é‡‘é ­è…¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* è‡ªå®šç¾©å‹•ç•«èˆ‡å­—å‹ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

        /* è¨­å®šä¸»è‰²è®Šæ•¸ï¼Œæ–¹ä¾¿çµ±ä¸€ç®¡ç† */
        :root {
            --brand-color: #248469;
            --brand-dark: #1a634e;
            --brand-light: #4dbfa3;
            --bg-deep: #051F1A;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-deep);
            overflow: hidden; /* é˜²æ­¢æ²å‹• */
            user-select: none;
        }

        /* ç§»é™¤åŸæœ¬çš„ shake å‹•ç•« */

        /* å½©å¸¶ç‰¹æ•ˆ */
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            top: -20px;
            z-index: 9999;
            opacity: 0;
        }
        @keyframes fall {
            0% { opacity: 1; top: -20px; transform: translateX(0) rotate(0deg); }
            100% { opacity: 0; top: 110vh; transform: translateX(100px) rotate(720deg); }
        }
        
        /* é¸é …æŒ‰éˆ•æ¨£å¼ - ä½¿ç”¨è‡ªå®šç¾©é¡è‰² */
        .hexagon-btn {
            transition: all 0.2s;
        }
        .hexagon-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* é€²å ´å‹•ç•« */
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }
        .animate-fade-in {
            animation: fadeInScale 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="text-white h-screen flex flex-col">

    <div class="flex justify-between items-center p-3 md:p-4 bg-[#0d332b] border-b border-[#248469]/50 z-10 shrink-0">
        <div class="flex items-center gap-4">
            <button id="resetBtn" class="flex items-center gap-2 px-4 py-2 bg-[#1a4f42] text-teal-100 hover:text-white hover:bg-[#248469] rounded-lg transition-colors text-sm font-bold border border-[#248469]/50">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i> é‡ç½®
            </button>
        </div>

      <div class="flex items-center gap-2 md:gap-4">
    <img src="https://www.hssh.tp.edu.tw/var/file/0/1000/img/7/123135.png" class="h-10 md:h-16 w-auto drop-shadow-lg" />
    <div class="text-xl md:text-3xl font-black tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-[#4ade80] to-[#2dd4bf] drop-shadow-lg">
        è¥¿æ¾åœ–æ›¸é¤¨é‡‘é ­è…¦æŒ‘æˆ°è³½
    </div>
</div>

        <div class="flex items-center gap-4">
            <button id="muteBtn" class="p-2 rounded-full border-2 transition-all bg-[#1a4f42] border-[#248469]/50 text-teal-200 hover:bg-[#248469] hover:text-white">
                <i data-lucide="volume-x" class="w-5 h-5"></i>
            </button>
            
            <div id="levelDisplay" class="flex items-center gap-2 bg-[#1a4f42] px-4 py-2 rounded-full border border-[#248469] opacity-0 transition-opacity">
                <i data-lucide="trophy" class="w-5 h-5 text-yellow-400"></i>
                <span id="levelIndicator" class="font-bold text-yellow-400">Question 1</span>
                <span class="text-teal-200 text-sm">/ 30</span>
            </div>
        </div>
    </div>

    <div id="gameContainer" class="flex-grow relative p-4 flex flex-col items-center justify-center w-full max-w-7xl mx-auto z-10 overflow-hidden">
        </div>

    <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_10%,_var(--tw-gradient-stops))] from-[#248469]/20 via-[#051F1A] to-[#051F1A] pointer-events-none z-0"></div>

    <script>
        // -----------------------------------------------------------------------------
        // è³‡æ–™è¨­å®š
        // -----------------------------------------------------------------------------
        const AUDIO_URLS = {
            correct: "https://app.aaronshi.cc/word-link/correct.mp3",
            wrong: "https://app.aaronshi.cc/word-link/wrong.mp3",
            bgm: "https://app.aaronshi.cc/word-link/background.mp3"
        };

        // å…± 30 é¡Œ
        const QUESTIONS = [
            { level: 1, question: "è¥¿æ¾é«˜ä¸­ç›®å‰æ™®éå®˜æ–¹ä¸»è¦ä½¿ç”¨çš„è‹±æ–‡ç¸®å¯«ç‚ºä½•ï¼Ÿ", options: ["HSSH", "XSSH", "HSSHS", "XSSHS"], answer: 1 },
            { level: 2, question: "åœ¨åœ–æ›¸é¤¨ä¸­ï¼Œæ›¸æœ¬çš„æ›¸æ¨™å“ªä¸€éƒ¨åˆ†æ˜¯è‡ªå·±ç¨æœ‰çš„ç·¨è™Ÿ?", options: ["åˆ†é¡è™Ÿ", "ä½œè€…è™Ÿ", "å†Šæ¬¡è™Ÿ", "ç™»éŒ„è™Ÿ"], answer: 3 },
            { level: 3, question: "è¥¿æ¾é«˜ä¸­å»ºæ ¡è‡³ä»Šå·²å¹¾å¹´ï¼Ÿ", options: ["57", "58", "59", "60"], answer: 1 },
            { level: 4, question: "åœ‹ä¸­ç”Ÿä¸èƒ½æŠŠä¸‹åˆ—å“ªç¨®æ›¸ç±å€Ÿå‡ºé¤¨å¤–ï¼Ÿ", options: ["å­—å…¸", "æ¼«ç•«", "ç™¾ç§‘å…¨æ›¸", "è¨€æƒ…å°èªª"], answer: 1 },
            { level: 5, question: "æœ¬æ ¡ç›®å‰åœ‹ä¸ƒæ‰€ä½¿ç”¨çš„å¤§å‹äº’å‹•è§¸æ§é¡¯ç¤ºå™¨ï¼ˆå¤§å±ï¼‰çš„å“ç‰Œç‚ºä½•ï¼Ÿ", options: ["ViewSonic", "BenQ", "Jector", "Avocor"], answer: 0 },
            { level: 6, question: "è¥¿æ¾é«˜ä¸­æ–¼å“ªä¸€å¹´å¢è¨­é«˜ä¸­éƒ¨ï¼Œæ­£å¼å¾è¥¿æ¾åœ‹ä¸­è®Šæˆè¥¿æ¾é«˜ä¸­ï¼Ÿ", options: ["æ°‘åœ‹75å¹´", "æ°‘åœ‹86å¹´", "æ°‘åœ‹97å¹´", "æ°‘åœ‹108å¹´"], answer: 1 },
            { level: 7, question: "åœ¨ç«¥è©±æ•…äº‹ã€Šä¸‰éš»å°è±¬ã€‹ä¸­ï¼Œå¤§é‡ç‹¼æ˜¯ç”¨ä»€éº¼å¹å€’äº†è±¬å¤§å“¥çš„æˆ¿å­ï¼Ÿ", options: ["é›»é¢¨æ‰‡", "å¹é¢¨æ©Ÿ", "å˜´å·´å¹æ°£", "é¢±é¢¨"], answer: 2 },
            { level: 8, question: "ä»¥ä¸‹å“ªå€‹ä¸æ˜¯è¥¿æ¾é«˜ä¸­æ‰€è¨­ç«‹çš„è™•å®¤ï¼Ÿ", options: ["åœ–æ›¸é¤¨", "åœ‹éš›äº¤æµè™•", "å¯¦é©—ç ”ç©¶è™•", "æ•™å‹™è™•"], answer: 2 },
            { level: 9, question: "è«‹å•åœ–æ›¸é¤¨çš„é¤¨å“¡éƒ½å¾ˆæ²‰é»˜ï¼Ÿï¼ˆå†·ç¬‘è©±ï¼‰", options: ["å› ç‚ºåœ¨é¤¨å…§ä¸èƒ½è¬›è©±", "å› ç‚ºä»–å€‘è¼¸ä¸èµ·", "å› ç‚ºä»–å€‘ä¸æƒ³èªªè©±", "åªæ˜¯ä½ æ²’è½åˆ°ä»–å€‘èªªè©±"], answer: 1 },
            { level: 10, question: "è¥¿æ¾é«˜ä¸­åœ–æ›¸é¤¨å¸¸æ…‹ç·¨åˆ¶äººåŠ›æ•¸é‡ç‚ºä½•ï¼Ÿ", options: ["5äºº", "6äºº", "7äºº", "8äºº"], answer: 0 },
            { level: 11, question: "è«‹å•åœ–æ›¸é¤¨çš„è‹±æ–‡å–®å­—æ˜¯ä»¥ä¸‹å“ªå€‹å­—ï¼Ÿ", options: ["Liberty", "Library", "Lavatory", "Laboratory"], answer: 1 },
            { level: 12, question: "æœ¬æ ¡ç›®å‰åœ‹å…«æ‰€ä½¿ç”¨çš„å¤§å‹äº’å‹•è§¸æ§é¡¯ç¤ºå™¨ï¼ˆå¤§å±ï¼‰çš„å“ç‰Œç‚ºä½•ï¼Ÿ", options: ["ViewSonic", "BenQ", "Jector", "Avocor"], answer: 0 },
            { level: 13, question: "ç›®å‰åœ–æ›¸é¤¨è³‡è¨Šçµ„æ‰€ç®¡ç†çš„æ ¡åœ’æ•™è‚²è¼‰å…·ä¸åŒ…å«ä»¥ä¸‹ä½•ç¨®ï¼Ÿ", options: ["Surface Go", "iPad", "ProBook", "é€™é¡Œåªæœ‰ä¸‰å€‹é¸é …"], answer: 2 },
            { level: 14, question: "åœ–æ›¸é¤¨ä¸€èˆ¬å­¸ç”Ÿå€Ÿæ›¸å¯å€Ÿå¤šä¹…å‘¢ï¼Ÿ", options: ["7å¤©", "15å¤©", "30å¤©", "60å¤©"], answer: 2 },
            { level: 15, question: "åœ–æ›¸é¤¨ä¸€èˆ¬å­¸ç”Ÿå€Ÿæ›¸å¯å€Ÿå¹¾å†Šæ›¸ç±å‘¢ï¼Ÿ", options: ["7å†Š", "8å†Š", "9å†Š", "10å†Š"], answer: 0 },
            { level: 16, question: "å­¸æ ¡çš„å­¸ç”ŸWi-Fiå¸³è™Ÿæ˜¯ä¸‹åˆ—ä½•è€…ï¼Ÿ", options: ["èº«åˆ†è­‰å­—è™Ÿ", "ç”Ÿæ—¥", "å­¸è™Ÿ", "ç­ç´šåº§è™Ÿ"], answer: 2 },
            { level: 17, question: "æ“”ä»»åœ–æ›¸é¤¨çš„åœ–æ›¸å¿—å·¥æˆ–è³‡è¨Šå¿—å·¥å¯å€Ÿå¹¾å†Šæ›¸ç±å‘¢ï¼Ÿ", options: ["7å†Š", "8å†Š", "9å†Š", "10å†Š"], answer: 3 },
            { level: 18, question: "æœ¬æ ¡ç›®å‰åœ‹ä¹æ‰€ä½¿ç”¨çš„å¤§å‹äº’å‹•è§¸æ§é¡¯ç¤ºå™¨ï¼ˆå¤§å±ï¼‰çš„å“ç‰Œç‚ºä½•ï¼Ÿ", options: ["ViewSonic", "BenQ", "Jector", "Avocor"], answer: 1 },
            { level: 19, question: "ä»¥ä¸‹å“ªç¨®æ›¸ç±ä¸€èˆ¬å€‹äººå­¸ç”Ÿå¯ä»¥å€Ÿå‡ºé¤¨å¤–é–±è¦½ï¼Ÿ", options: ["è¼•å°èªª", "ç­æ›¸", "åƒè€ƒæ›¸", "ç•¶æœŸé›œèªŒ"], answer: 0 },
            { level: 20, question: "å­¸ç”Ÿä½¿ç”¨å®Œå­¸æ ¡çš„Surface Goè¡Œå‹•è¼‰å…·å¾Œï¼Œä¸éœ€è¦åšä»¥ä¸‹å“ªå€‹å‹•ä½œï¼Ÿ", options: ["ç™»å‡ºå€‹äººå¸³è™Ÿ", "é‡çŒé›»è…¦", "åˆªé™¤ä¸‹è¼‰çš„æª”æ¡ˆ", "é—œæ©Ÿ"], answer: 1 },
            { level: 21, question: "å­¸æ ¡çš„é›»è©±è™Ÿç¢¼æ˜¯å¹¾è™Ÿï¼Ÿ", options: ["2528-6618", "2528-6688", "2528-8866", "2528-6681"], answer: 0 },
            { level: 22, question: "åœ–æ›¸é¤¨åœ¨å­¸æ ¡çš„å¹¾æ¨“ï¼Ÿ", options: ["2F", "3F", "4F", "5F"], answer: 3 },
            { level: 23, question: "è«‹å•åœ–æ›¸é¤¨è³‡è¨Šçµ„çš„æ­£å¼è‹±æ–‡ç¸®å¯«ç‚ºä½•ï¼Ÿ", options: ["IT Section", "ITT Section", "ICT Section", "ICS Section"], answer: 2 },
            { level: 24, question: "æœ¬æ ¡ç›®å‰é«˜ä¸€æ‰€ä½¿ç”¨çš„å¤§å‹äº’å‹•è§¸æ§é¡¯ç¤ºå™¨ï¼ˆå¤§å±ï¼‰çš„å“ç‰Œç‚ºä½•ï¼Ÿ", options: ["ViewSonic", "BenQ", "Jector", "Avocor"], answer: 0 },
            { level: 25, question: "ç¾ä»»114å­¸å¹´åº¦åœ–æ›¸é¤¨ä¸»ä»»ç‚ºä½•ï¼Ÿ", options: ["æ›¹å–»æ¶µ", "çŸ³å²¡", "æ—äºå©·", "å¼µè²½å©·"], answer: 3 },
            { level: 26, question: "æœ¬æ ¡ç›®å‰é«˜äºŒæ‰€ä½¿ç”¨çš„å¤§å‹äº’å‹•è§¸æ§é¡¯ç¤ºå™¨ï¼ˆå¤§å±ï¼‰çš„å“ç‰Œç‚ºä½•ï¼Ÿ", options: ["ViewSonic", "BenQ", "Jector", "Avocor"], answer: 2 },
            { level: 27, question: "è«‹å•ä¸‹åˆ—é—œæ–¼å­¸æ ¡çš„æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ", options: ["è¥¿æ¾é«˜ä¸­ä»¥å‰æ˜¯è¥¿æ¾åœ‹ä¸­ã€‚", "è¥¿æ¾é«˜ä¸­æ˜¯æ¾å±±å€å”¯ä¸€çš„é«˜ä¸­ã€‚", "è¥¿æ¾é«˜ä¸­å’Œæ¾å±±é«˜ä¸­ä½æ–¼åŒä¸€å€‹è¡Œæ”¿å€ã€‚", "è¥¿æ¾é«˜ä¸­æ˜¯å°åŒ—å¸‚ç¬¬ä¸€å¿—é¡˜çš„é«˜ä¸­ã€‚"], answer: 0 },
            { level: 28, question: "è«‹å•ä»¥ä¸‹ä¸æ˜¯æœ¬æ ¡çš„ç‰¹è‰²ç­ç´šï¼Ÿ", options: ["è‹±èªè³‡å„ªç­", "åœ‹éš›æ–‡æ†‘å¯¦é©—ç­", "æ•¸ç†è³‡å„ªç­", "é«”è‚²ç­"], answer: 2 },
            { level: 29, question: "è«‹å•è¥¿æ¾é«˜ä¸­çš„æ ¡æ…¶æ˜¯åœ¨æ¯å¹´çš„å¹¾æœˆèˆ‰è¡Œå‘¢ï¼Ÿ", options: ["9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"], answer: 2 },
            { level: 30, question: "æœ¬æ ¡ç›®å‰é«˜ä¸‰æ‰€ä½¿ç”¨çš„å¤§å‹äº’å‹•è§¸æ§é¡¯ç¤ºå™¨ï¼ˆå¤§å±ï¼‰çš„å“ç‰Œç‚ºä½•ï¼Ÿ", options: ["ViewSonic", "BenQ", "Jector", "Avocor"], answer: 2 }
        ];

        // 30 å€‹çå“
        const TOTAL_PRIZES = 30;
        const STORAGE_KEY = 'classroom_millionaire_v2';

        // -----------------------------------------------------------------------------
        // ç‹€æ…‹ç®¡ç†
        // -----------------------------------------------------------------------------
        let state = {
            gameState: 'START',  // åˆå§‹ç‹€æ…‹æ”¹ç‚º START
            currentLevel: 0,
            takenPrizes: [],
            isMuted: true,
            selectedOption: null,
            revealState: 'idle',
            pendingPrizeId: null
        };

        const bgm = new Audio(AUDIO_URLS.bgm);
        bgm.loop = true;
        bgm.volume = 0.3;

        // -----------------------------------------------------------------------------
        // åˆå§‹åŒ–èˆ‡å­˜æª”
        // -----------------------------------------------------------------------------
        function init() {
            loadGame();
            render();
            setupGlobalListeners();
        }

        function loadGame() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state.currentLevel = parsed.currentLevel || 0;
                    state.takenPrizes = parsed.takenPrizes || [];
                    // é€™è£¡ä¸ç›´æ¥æ”¹ gameState ç‚º WINï¼Œè®“ä½¿ç”¨è€…å…ˆçœ‹åˆ°é¦–é ï¼Œé»é–‹å§‹å¾Œå†åˆ¤æ–·
                } catch (e) {
                    console.error("Load failed", e);
                }
            }
        }

        function saveGame() {
            const data = {
                currentLevel: state.currentLevel,
                takenPrizes: state.takenPrizes
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // -----------------------------------------------------------------------------
        // æ ¸å¿ƒé‚è¼¯
        // -----------------------------------------------------------------------------
        
        // æ–°å¢ï¼šé–‹å§‹éŠæˆ²é‚è¼¯
        function startGame() {
            // å˜—è©¦æ’­æ”¾éŸ³æ¨‚ (åˆ©ç”¨ä½¿ç”¨è€…äº’å‹•è§£é™¤ç€è¦½å™¨éœéŸ³é™åˆ¶)
            if (!state.isMuted) {
                bgm.play().catch(e => console.log("Audio autoplay check", e));
            } else {
                 // å¦‚æœç•¶å‰æ˜¯éœéŸ³ï¼Œæˆ‘å€‘ä»ç„¶å˜—è©¦æº–å‚™ audio contextï¼Œä½†æš«åœ
                 bgm.play().then(() => bgm.pause()).catch(() => {});
            }

            // åˆ¤æ–·æ˜¯å¦å·²å…¨é€šé—œ
            if (state.currentLevel >= QUESTIONS.length) {
                state.gameState = 'WIN';
            } else {
                state.gameState = 'PLAYING';
            }
            render();
        }

        function playSfx(type) {
            if (state.isMuted) return;
            const audio = new Audio(AUDIO_URLS[type]);
            audio.volume = 0.8;
            audio.play().catch(e => console.log("SFX Play failed", e));
        }

        function toggleMute() {
            state.isMuted = !state.isMuted;
            const btn = document.getElementById('muteBtn');
            
            if (state.isMuted) {
                bgm.pause();
                btn.innerHTML = `<i data-lucide="volume-x" class="w-5 h-5"></i>`;
                btn.classList.remove('bg-[#248469]', 'text-white', 'shadow-[0_0_10px_rgba(36,132,105,0.5)]');
                btn.classList.add('bg-[#1a4f42]', 'text-teal-200');
            } else {
                bgm.play().catch(e => console.log("BGM Play failed - interaction needed"));
                btn.innerHTML = `<i data-lucide="volume-2" class="w-5 h-5"></i>`;
                btn.classList.remove('bg-[#1a4f42]', 'text-teal-200');
                btn.classList.add('bg-[#248469]', 'text-white', 'shadow-[0_0_10px_rgba(36,132,105,0.5)]');
            }
            lucide.createIcons();
        }

        function handleReset() {
            if (confirm('ç¢ºå®šè¦é‡ç½®æ•´å€‹éŠæˆ²å—ï¼Ÿæ‰€æœ‰é€²åº¦å’Œçå“é ˜å–ç´€éŒ„å°‡æœƒæ¶ˆå¤±ï¼')) {
                localStorage.removeItem(STORAGE_KEY);
                state.currentLevel = 0;
                state.takenPrizes = [];
                state.gameState = 'START'; // é‡ç½®å›é¦–é 
                state.selectedOption = null;
                state.revealState = 'idle';
                state.pendingPrizeId = null;
                render();
            }
        }

        function handleOptionClick(idx) {
            if (state.revealState !== 'idle') return;
            
            state.selectedOption = idx;
            state.revealState = 'selected';
            render();

            setTimeout(() => {
                state.revealState = 'revealed';
                const currentQ = QUESTIONS[state.currentLevel];
                const isCorrect = idx === currentQ.answer;
                
                playSfx(isCorrect ? 'correct' : 'wrong');
                render();

                setTimeout(() => {
                    if (isCorrect) {
                        state.gameState = 'PRIZE_SELECTION';
                        state.revealState = 'idle';
                        startConfetti();
                    } else {
                        state.gameState = 'GAMEOVER';
                    }
                    render();
                }, 2000);

            }, 2000);
        }

        function handlePrizeClick(id) {
            if (state.takenPrizes.includes(id)) return;
            state.pendingPrizeId = id;
            render();
        }

        function confirmPrize() {
            if (!state.pendingPrizeId) return;
            
            playSfx('correct');
            state.takenPrizes.push(state.pendingPrizeId);
            state.pendingPrizeId = null;
            saveGame();
            render();

            setTimeout(() => {
                if (state.currentLevel < QUESTIONS.length - 1) {
                    state.currentLevel++;
                    state.gameState = 'PLAYING';
                    state.selectedOption = null;
                } else {
                    state.gameState = 'WIN';
                }
                saveGame();
                render();
            }, 500);
        }

        function retryLevel() {
            state.gameState = 'PLAYING';
            state.selectedOption = null;
            state.revealState = 'idle';
            render();
        }

        function skipLevel() {
            if (state.currentLevel < QUESTIONS.length - 1) {
                state.currentLevel++;
                state.gameState = 'PLAYING';
                state.selectedOption = null;
                state.revealState = 'idle';
                state.pendingPrizeId = null;
            } else {
                state.gameState = 'WIN';
            }
            saveGame();
            render();
        }

        // -----------------------------------------------------------------------------
        // ç‰¹æ•ˆ
        // -----------------------------------------------------------------------------
        function startConfetti() {
            for (let i = 0; i < 50; i++) {
                const div = document.createElement('div');
                div.classList.add('confetti-piece');
                div.style.left = Math.random() * 100 + '%';
                div.style.backgroundColor = ['#248469', '#FFD700', '#4ade80', '#00BFFF', '#FFFFFF'][Math.floor(Math.random() * 5)];
                div.style.animation = `fall ${Math.random() * 3 + 2}s linear forwards`;
                div.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(div);
                setTimeout(() => div.remove(), 6000);
            }
        }

        // -----------------------------------------------------------------------------
        // æ¸²æŸ“ (Render)
        // -----------------------------------------------------------------------------
        function render() {
            const container = document.getElementById('gameContainer');
            const levelIndicator = document.getElementById('levelIndicator');
            const levelDisplayDiv = document.getElementById('levelDisplay');
            const body = document.body;

            // æ§åˆ¶é¡Œè™Ÿé¡¯ç¤ºï¼šåªæœ‰åœ¨ç©éŠæˆ²æˆ–æŠ½çæ™‚æ‰é¡¯ç¤º
            if (state.gameState === 'START' || state.gameState === 'WIN') {
                levelDisplayDiv.style.opacity = '0';
            } else {
                levelDisplayDiv.style.opacity = '1';
                levelIndicator.innerText = `Question ${state.currentLevel + 1}`;
            }
            
            // ç§»é™¤åŸæœ¬çš„ shake class æ“ä½œ
            if (state.gameState === 'GAMEOVER') {
                body.style.backgroundColor = '#2a0a0a'; // ç­”éŒ¯è®Šç´…
            } else {
                body.style.backgroundColor = '#051F1A'; // æ¢å¾©æ·±ç¶ 
            }

            container.innerHTML = '';

            // æ–°å¢ START ç‹€æ…‹åˆ¤æ–·
            if (state.gameState === 'START') {
                renderStartScreen(container);
            } else if (state.gameState === 'WIN') {
                renderWin(container);
            } else if (state.gameState === 'GAMEOVER') {
                renderGameOver(container);
            } else if (state.gameState === 'PRIZE_SELECTION') {
                renderPrizeSelection(container);
            } else {
                renderQuestion(container);
            }
            lucide.createIcons();
        }

        // æ–°å¢ï¼šé¦–é æ¸²æŸ“å‡½æ•¸
        function renderStartScreen(container) {
            const wrapper = document.createElement('div');
            wrapper.className = "flex flex-col items-center justify-center w-full max-w-4xl text-center space-y-12 animate-fade-in";
            
            wrapper.innerHTML = `
                <div class="space-y-6">
                    <div class="inline-block p-4 rounded-full bg-[#1a4f42] border-2 border-[#248469] shadow-[0_0_30px_rgba(36,132,105,0.6)] mb-4">
                        <i data-lucide="brain" class="w-20 h-20 md:w-32 md:h-32 text-[#4ade80]"></i>
                    </div>
                    <h1 class="text-4xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-br from-white to-teal-200 drop-shadow-lg tracking-wide">
                        è¥¿æ¾åœ–æ›¸é¤¨<br/>é‡‘é ­è…¦æŒ‘æˆ°è³½
                    </h1>
                    <p class="text-xl md:text-2xl text-teal-100 font-bold tracking-wider">
                        æº–å‚™å¥½æ¸¬è©¦ä½ çš„çŸ¥è­˜é‡äº†å—ï¼Ÿ
                    </p>
                </div>

                <div class="bg-[#133E35]/80 backdrop-blur-md border border-[#248469] p-8 md:p-10 rounded-3xl max-w-2xl w-full text-left shadow-xl">
                    <h3 class="text-2xl font-bold text-[#4ade80] mb-6 flex items-center gap-2">
                        <i data-lucide="scroll-text" class="w-6 h-6"></i> éŠæˆ²è¦å‰‡èªªæ˜
                    </h3>
                    <ul class="space-y-4 text-lg md:text-xl text-gray-200">
                        <li class="flex items-start gap-3">
                            <span class="bg-[#248469] text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mt-1 shrink-0">1</span>
                            <span>æœ¬éŠæˆ²å…±æœ‰ <b class="text-white">30 é“é¡Œç›®</b>ï¼ŒåŒ…å«å¸¸è­˜ã€ç§‘å­¸èˆ‡æ–‡åŒ–çŸ¥è­˜ã€‚</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="bg-[#248469] text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mt-1 shrink-0">2</span>
                            <span>ç­”å°é¡Œç›®å³å¯é€²å…¥ <b class="text-yellow-400">æŠ½çç’°ç¯€</b>ï¼Œé¸æ“‡ä¸€å€‹å¹¸é‹è™Ÿç¢¼ï¼</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="bg-[#248469] text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mt-1 shrink-0">3</span>
                            <span>ç­”éŒ¯æ™‚ç„¡æ³•æŠ½çï¼Œä½†å¯ä»¥é¸æ“‡ã€Œå†è©¦ä¸€æ¬¡ã€æˆ–ã€Œè·³éæ­¤é¡Œã€ã€‚</span>
                        </li>
                    </ul>
                </div>

                <button onclick="startGame()" class="group relative px-10 py-5 bg-gradient-to-r from-[#248469] to-[#1a634e] hover:from-[#4ade80] hover:to-[#248469] rounded-full text-2xl md:text-4xl font-black text-white shadow-[0_0_40px_rgba(36,132,105,0.6)] hover:shadow-[0_0_60px_rgba(74,222,128,0.6)] transition-all transform hover:-translate-y-1 active:scale-95 border-4 border-[#4ade80]/30">
                    <span class="flex items-center gap-4">
                        é–‹å§‹æŒ‘æˆ° <i data-lucide="arrow-right-circle" class="w-8 h-8 md:w-10 md:h-10"></i>
                    </span>
                    <div class="absolute inset-0 rounded-full bg-white/20 blur-md opacity-0 group-hover:opacity-100 transition-opacity"></div>
                </button>
            `;
            container.appendChild(wrapper);
        }

        function renderQuestion(container) {
            const q = QUESTIONS[state.currentLevel];
            
            const wrapper = document.createElement('div');
            wrapper.className = "flex flex-col w-full h-full max-w-5xl justify-center animate-fade-in";
            
            const qBox = document.createElement('div');
            // ä¸»é¡Œè‰²å¡ç‰‡
            qBox.className = "w-full mb-4 md:mb-8 bg-[#133E35]/90 backdrop-blur border-2 border-[#248469] py-6 px-8 md:px-16 rounded-3xl text-center shadow-[0_0_50px_rgba(36,132,105,0.3)] shrink-0";
            qBox.innerHTML = `<h2 class="text-2xl md:text-4xl lg:text-5xl font-bold leading-relaxed tracking-wide text-white drop-shadow-md">${q.question}</h2>`;
            wrapper.appendChild(qBox);

            const grid = document.createElement('div');
            grid.className = "w-full grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 flex-grow overflow-y-auto";
            
            q.options.forEach((opt, idx) => {
                // é¸é …é è¨­é¡è‰²
                let bgClass = "bg-[#1a4f42] border-[#248469]/50 hover:bg-[#206151] hover:shadow-[0_0_15px_rgba(36,132,105,0.4)]";
                let disabled = false;

                if (state.revealState !== 'idle') disabled = true;

                if (state.selectedOption === idx) {
                    bgClass = "bg-orange-600 border-white";
                }
                
                if (state.revealState === 'revealed') {
                    if (idx === q.answer) {
                        if (state.selectedOption === idx) {
                            bgClass = "bg-[#248469] border-white shadow-[0_0_30px_#248469] animate-pulse ring-2 ring-white";
                        }
                    } else if (state.selectedOption === idx) {
                        bgClass = "bg-red-700 border-white";
                    }
                } else if (!disabled) {
                    bgClass += " cursor-pointer hover:-translate-y-1";
                }

                const btnContainer = document.createElement('div');
                btnContainer.className = "flex items-center w-full min-h-[5rem]";
                btnContainer.innerHTML = `
                    <button class="hexagon-btn w-full h-full rounded-2xl border-4 shadow-lg flex items-center px-4 sm:px-8 py-2 ${bgClass}" ${disabled ? 'disabled' : ''}>
                        <span class="text-teal-300 font-bold mr-4 md:mr-6 text-2xl md:text-3xl">${['A','B','C','D'][idx]}:</span>
                        <span class="font-bold text-lg md:text-2xl lg:text-3xl text-left flex-grow leading-tight">${opt}</span>
                    </button>
                `;
                
                if (!disabled) {
                    btnContainer.querySelector('button').onclick = () => handleOptionClick(idx);
                }
                
                grid.appendChild(btnContainer);
            });
            wrapper.appendChild(grid);

            const footer = document.createElement('div');
            footer.className = "mt-4 flex flex-col items-center opacity-80 w-full shrink-0";
            renderProgressBar(footer);
            wrapper.appendChild(footer);

            container.appendChild(wrapper);
        }

        function renderPrizeSelection(container) {
            const wrapper = document.createElement('div');
            wrapper.className = "flex flex-col items-center justify-between w-full h-full z-20 animate-[pop_0.5s_ease-out]";
            
            wrapper.innerHTML = `
                <div class="text-center mb-2 shrink-0">
                    <h2 class="text-4xl md:text-5xl font-black text-[#4ade80] drop-shadow-[0_0_15px_rgba(74,222,128,0.5)] animate-pulse">ç­”å°äº†ï¼</h2>
                    <p class="text-lg md:text-xl text-teal-100">è«‹é»é¸ä¸€å€‹çå“è™Ÿç¢¼ï¼Œç„¶å¾ŒæŒ‰ä¸‹ç¢ºèª</p>
                </div>
            `;

            const grid = document.createElement('div');
            grid.className = "grid grid-cols-6 grid-rows-5 gap-2 md:gap-3 max-w-6xl w-full flex-1 min-h-0";

            for(let i=1; i<=TOTAL_PRIZES; i++) {
                const isTaken = state.takenPrizes.includes(i);
                const isSelected = state.pendingPrizeId === i;
                
                let btnClass = "bg-gradient-to-br from-[#4dbfa3] to-[#248469] border-[#7ee0c6] hover:scale-[1.05] cursor-pointer shadow-lg";
                
                if (isTaken) btnClass = "bg-[#133E35] border-[#1a4f42] opacity-40 cursor-not-allowed";
                if (isSelected) btnClass = "bg-[#4ade80] border-white ring-4 ring-[#248469] scale-[1.1] shadow-[0_0_30px_rgba(36,132,105,1)] z-20";

                const btn = document.createElement('button');
                btn.className = `relative w-full h-full rounded-lg md:rounded-xl border-2 md:border-4 flex flex-col items-center justify-center transition-all duration-200 ${btnClass}`;
                btn.disabled = isTaken;
                
                if (isTaken) {
                    btn.innerHTML = `<i data-lucide="check" class="w-5 h-5 md:w-8 md:h-8 text-teal-500"></i><span class="absolute bottom-1 text-[10px] md:text-xs text-teal-500 font-bold">å·²é ˜</span>`;
                } else {
                    btn.innerHTML = `
                        <i data-lucide="gift" class="w-4 h-4 md:w-6 md:h-6 mb-1 text-white/90"></i>
                        <span class="text-xl md:text-3xl font-black text-white drop-shadow-md">${i}</span>
                    `;
                    btn.onclick = () => handlePrizeClick(i);
                }
                grid.appendChild(btn);
            }
            wrapper.appendChild(grid);

            const actionArea = document.createElement('div');
            actionArea.className = "h-20 mt-4 flex items-center justify-center w-full shrink-0";
            
            if (state.pendingPrizeId) {
                const confirmBtn = document.createElement('button');
                confirmBtn.className = "flex items-center gap-3 px-8 py-3 md:px-12 md:py-4 bg-[#248469] hover:bg-[#1a634e] rounded-full text-2xl md:text-3xl font-bold shadow-[0_0_20px_rgba(36,132,105,0.8)] animate-bounce text-white transition-transform active:scale-95 border-2 border-[#4ade80]";
                confirmBtn.innerHTML = `<i data-lucide="check" class="w-6 h-6 md:w-8 md:h-8"></i> ç¢ºèªé ˜å– ${state.pendingPrizeId} è™Ÿ`;
                confirmBtn.onclick = confirmPrize;
                actionArea.appendChild(confirmBtn);
            } else {
                actionArea.innerHTML = `<div class="text-teal-400 text-lg md:text-xl font-bold">è«‹é»æ“Šä¸Šæ–¹æ ¼å­é¸æ“‡...</div>`;
            }
            wrapper.appendChild(actionArea);

            container.appendChild(wrapper);
        }

        function renderGameOver(container) {
            const q = QUESTIONS[state.currentLevel];
            container.innerHTML = `
                <div class="text-center space-y-8 max-w-2xl w-full bg-[#2a0a0a] p-12 rounded-3xl border-4 border-red-800 shadow-[0_0_50px_rgba(220,38,38,0.3)] animate-fade-in">
                    <div class="text-8xl">ğŸ˜¢</div>
                    <h2 class="text-5xl font-bold text-red-500">ç­”éŒ¯äº†...</h2>
                    
                    <div class="flex flex-col gap-4 mt-8">
                        <button onclick="retryLevel()" class="px-8 py-4 bg-[#248469] hover:bg-[#1a634e] rounded-xl font-bold text-2xl w-full text-white transition-transform active:scale-95 shadow-lg border-2 border-[#4ade80]">
                            å†è©¦ä¸€æ¬¡æœ¬é¡Œ
                        </button>
                        <button onclick="skipLevel()" class="px-8 py-4 bg-[#1a4f42] hover:bg-[#206151] rounded-xl font-bold text-xl w-full text-teal-200 hover:text-white transition-transform active:scale-95 border border-[#248469]">
                            è·³éæ­¤é¡Œ (ä¸é ˜ç)
                        </button>
                    </div>
                </div>
            `;
        }

        function renderWin(container) {
            startConfetti();
            let prizesHtml = state.takenPrizes.sort((a,b)=>a-b).map(p => 
                `<span class="inline-block bg-[#248469] text-white px-3 py-1 rounded-full font-mono text-lg m-1 border border-[#4ade80]">#${p}</span>`
            ).join('');

            container.innerHTML = `
                <div class="text-center space-y-6 z-10 animate-fade-in">
                    <div class="flex justify-center"><i data-lucide="trophy" class="w-48 h-48 text-yellow-400 animate-bounce"></i></div>
                    <h1 class="text-5xl md:text-7xl font-bold text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]">é€šé—œæˆåŠŸï¼</h1>
                    <p class="text-teal-100 text-2xl">å¤§å®¶å¤ªå²å®³äº†ï¼Œå·²å®Œæˆæ‰€æœ‰æŒ‘æˆ°ï¼</p>
                    <div class="p-6 bg-[#133E35]/80 backdrop-blur rounded-xl border-2 border-[#248469] max-w-2xl mx-auto mt-8">
                        <h3 class="text-xl mb-4 text-[#4ade80] font-bold">å·²é ˜å–çš„çå“ç·¨è™Ÿ</h3>
                        <div class="flex flex-wrap justify-center max-h-48 overflow-y-auto">
                            ${prizesHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProgressBar(container) {
            const percent = (state.takenPrizes.length / TOTAL_PRIZES) * 100;
            
            container.innerHTML = `
               <div class="flex justify-between w-full max-w-md text-teal-300 font-bold mb-1">
                  <span>çå“é€²åº¦</span>
                  <span>${state.takenPrizes.length} / ${TOTAL_PRIZES}</span>
               </div>
               <div class="h-3 w-full max-w-md bg-[#133E35] rounded-full overflow-hidden border border-[#1a634e]">
                  <div class="h-full bg-gradient-to-r from-[#248469] to-[#4ade80] transition-all duration-500 shadow-[0_0_10px_#248469]" style="width: ${percent}%"></div>
               </div>
            `;
        }

        function setupGlobalListeners() {
            document.getElementById('resetBtn').addEventListener('click', handleReset);
            document.getElementById('muteBtn').addEventListener('click', toggleMute);
        }

        // Start Game
        init();

    </script>
</body>
</html>



